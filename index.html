// ১. ডাটাবেজ থেকে ব্যাচ ও ক্লাস লোড করার ফাংশন
async function syncSystem() {
    // academy_settings টেবিল থেকে ডাটা আনা
    const { data: settings } = await _supabase.from('academy_settings').select('*');
    
    if (settings) {
        const batches = settings.filter(i => i.type === 'batch').map(i => i.value);
        const classes = settings.filter(i => i.type === 'class').map(i => i.value);

        // সব ড্রপডাউন (ভর্তি ফরম ও ফিল্টার) আপডেট করা
        const batchPickers = document.querySelectorAll('.dynamic-batch-list');
        const classPickers = document.querySelectorAll('.dynamic-class-list');

        batchPickers.forEach(p => {
            p.innerHTML = batches.map(b => `<option value="${b}">${b}</option>`).join('');
        });

        classPickers.forEach(p => {
            p.innerHTML = classes.map(c => `<option value="${c}">${c}</option>`).join('');
        });

        // সেটিংস ট্যাবে ব্যাচ/ক্লাস লিস্ট দেখানো (যাতে ডিলিট করা যায়)
        document.getElementById('configBatchList').innerHTML = batches.filter(b => b !== 'All').map(b => `
            <li class="flex justify-between items-center bg-slate-50 p-2 rounded-lg mb-1">
                ${b} <button onclick="deleteConfigFromDB('${b}')" class="text-red-500 font-bold">✖</button>
            </li>
        `).join('');

        document.getElementById('configClassList').innerHTML = classes.map(c => `
            <li class="flex justify-between items-center bg-slate-50 p-2 rounded-lg mb-1">
                ${c} <button onclick="deleteConfigFromDB('${c}')" class="text-red-500 font-bold">✖</button>
            </li>
        `).join('');
    }
    loadStudents(); // ছাত্রছাত্রীর লিস্ট লোড করা
}

// ২. ডাটাবেজে নতুন ব্যাচ/ক্লাস যোগ করা
async function addConfigToDB(type) {
    const inputId = type === 'batch' ? 'newBatchName' : 'newClassName';
    const val = document.getElementById(inputId).value.trim();
    if(!val) return;

    const { error } = await _supabase.from('academy_settings').insert([{ type, value: val }]);
    if(!error) {
        document.getElementById(inputId).value = '';
        syncSystem(); // সাথে সাথে আপডেট করা
    } else {
        alert("এটি অলরেডি আছে অথবা কোনো এরর হয়েছে।");
    }
}

// ৩. ডাটাবেজ থেকে ডিলিট করা
async function deleteConfigFromDB(val) {
    if(confirm(`আপনি কি '${val}' চিরতরে মুছে ফেলতে চান?`)) {
        await _supabase.from('academy_settings').delete().eq('value', val);
        syncSystem();
    }
}
